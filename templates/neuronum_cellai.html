
<!DOCTYPE html>
<html lang="en">
  <head>                              
  <meta name="description" content="Neuronum is the real-time data engine for developers to build AI native apps and services in minutes using high-level Python">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="max-image-preview: none">
  <title>Neuronum: The Real-Time E2E Browser</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/static/favicon.png" />
  <link rel="stylesheet" href="/static/desktop_design.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<style>
   #html-output {
        display: none;
        background-color: inherit;
        border: 1px solid var(--border-color-dark);
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0 0 0;
        max-width: 90vw;
        height: 300px;
        overflow: auto;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        flex-shrink: 0;
      }



/* Toggle button inside log */
#toggle-log {
  position: absolute;
  top: 8px;
  right: 12px;
  background: transparent;
  border: none;
  color: #d8d8d8;
  font-size: 16px;
  cursor: pointer;
  outline: none;
  z-index: 1100;
}

#toggle-log:hover {
  color: #ffffff;
}

/* Entries container inside log */
#log-entries {
  margin-top: 30px;
  flex-grow: 1;
  overflow-y: auto;
}

 #message-log {
      position: fixed;
      bottom: 40px; /* move above the footer */
      right: 20px;
      width: 340px;
      max-height: 520px;
      padding: 20px;
      background-color: none;/* close to black, matches footer */
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgb(22, 22, 22); /* matches .fixedFooter */
      font-family: 'Fira Mono', monospace, 'Courier New', monospace;
      font-size: 13px;
      color: #d0d4d8;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }

/* Scrollbar */
#message-log::-webkit-scrollbar {
  width: 8px;
}
#message-log::-webkit-scrollbar-track {
  background: transparent;
}
#message-log::-webkit-scrollbar-thumb {
  background-color: rgba(5, 5, 5, 0.15);
  border-radius: 4px;
  border: 2px solid transparent;
  background-clip: content-box;
}

/* Log entries */
.log-entry {
  margin-bottom: 12px;
  padding: 10px 14px;
  background: rgba(11, 11, 11, 0.8);
  border-radius: 12px;
  color: #cbd0d8;
  font-weight: 500;
  letter-spacing: 0.02em;
  white-space: pre-wrap;
  word-break: break-word;
  transition: background 0.3s ease, color 0.3s ease;
}

.log-entry:hover {
  background: rgba(55, 55, 70, 0.85);
  color: #ffffff;
}

/* Closed state */
#message-log.closed {
  max-height: 80px;
  width: 80px;
  height: 50px;
  border-radius: 30px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s ease;
}


#message-log.closed #log-entries {
  display: none;
}

#message-log.closed #toggle-log i {
  transform: rotate(-90deg);
}

.node-list {
  margin: 30px auto 60px auto;
  max-width: 900px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  padding: 10px 20px;
  background: rgba(15, 15, 15, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 14px;
  font-family: "Inter", sans-serif;
  color: #eaeaea;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
}

.node-card {
  background: rgba(255, 255, 255, 0.03);
  padding: 14px 20px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  font-size: 14px;
  line-height: 1.5;
}




</style>
</head>
  <body class="pageContainer">

    <div id="html-output" class="html-container"></div>

    <div id="node-list" class="node-list"></div>
    
    <div id="message-log" class="open">
      <button id="toggle-log" aria-label="Toggle message log">
        <i class="fas fa-chevron-down"></i>
      </button>
      <div id="log-entries"></div>
    </div>
     
      <div class="footerContainer">
       <a href="#" id="disconnect-btn" class="backButton">
          <i class="fas fa-long-arrow-alt-left"></i>
        </a>

      <div class="fixedFooter">
        <a href="/"><img src="/static/logo.png" alt="Neuronum Logo - A Cyber Neuron" class="headerLogo" ></a>
        <a class="footerMail"><span id="host"></span></a>
      </div>
    </div>

   <script>
  window.onload = function () {
    const host = localStorage.getItem('host');
    const password = localStorage.getItem('password');
    const synapse = localStorage.getItem('synapse');

    const hostSpan = document.getElementById('host');
    if (host && hostSpan) {
      hostSpan.textContent = host;
    } else {
      hostSpan.textContent = 'no host';
    }

    const messageLog = document.getElementById('message-log');
    const logEntries = document.getElementById('log-entries') || messageLog;

    function appendToLog(message) {
      const div = document.createElement("div");
      div.classList.add("log-entry");
      div.textContent = message;
      logEntries.prepend(div);
    }

    async function fetchNodes({ host, password, synapse }) {
  const payload = {
    cell: {
      host,
      password,
      synapse
    }
  };

  try {
    const response = await fetch("https://neuronum.net/api/list_nodes", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    const result = await response.json();

    if (!response.ok) {
      appendToLog("❌ Server error: " + (result.message || response.statusText));
      return;
    }

    const nodeListContainer = document.getElementById('node-list');
    nodeListContainer.innerHTML = ""; // Clear previous content

    if (result.success) {
      appendToLog("✅ Nodes received:");

      result.Nodes.forEach(node => {
        appendToLog(`- ${node.nodeID}: ${node.descr}`);

        const nodeCard = document.createElement("div");
        nodeCard.className = "node-card";
        nodeCard.innerHTML = `
          <strong>ID:</strong> ${node.nodeID}<br>
          <strong>Description:</strong> ${node.descr}<br>
          <strong>Creator:</strong> ${node.creator}<br>
          <strong>Config:</strong> <pre>${JSON.stringify(node.config, null, 2)}</pre>
        `;

        nodeListContainer.appendChild(nodeCard);
      });
    } else {
      appendToLog("⚠️ " + result.Nodes);
    }
  } catch (err) {
    appendToLog("❌ Fetch failed: " + (err.message || "Unknown error"));
  }
}


    function connectWebSocket() {
      socket = new WebSocket("wss://neuronum.net/sync/neuronum::stx");
      socket.onopen = () => {
        const payload = { host, password, synapse };
        socket.send(JSON.stringify(payload));
        appendToLog(">> Sent: " + JSON.stringify(payload));
      };

      socket.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          const label = data.label;
          const payload = data.data || {};

          appendToLog("<< " + (payload.json || event.data));

          if (label === "tx_response" && payload.html) {
            const htmlOutput = document.getElementById("html-output");
            htmlOutput.style.display = "flex";
            htmlOutput.innerHTML = payload.html;

            const scripts = htmlOutput.querySelectorAll("script");
            scripts.forEach(oldScript => {
              const newScript = document.createElement("script");
              if (oldScript.src) {
                newScript.src = oldScript.src;
                newScript.async = false;
              } else {
                newScript.textContent = oldScript.textContent;
              }
              oldScript.parentNode.replaceChild(newScript, oldScript);
            });
          }
        } catch (e) {
          console.error("Invalid JSON in message:", e);
          appendToLog("!! Invalid JSON");
        }
      };

      socket.onclose = () => {
        appendToLog("!! Stream closed");
      };

      socket.onerror = (err) => {
        console.error("WebSocket error:", err);
        appendToLog("!! WebSocket error");
      };
    }

    connectWebSocket();

    if (host && password && synapse) {
      fetchNodes({ host, password, synapse });
    } else {
      appendToLog("⚠️ Missing host, password or synapse.");
    }

    // Disconnect button handler
const disconnectBtn = document.getElementById("disconnect-btn");
if (disconnectBtn) {
  disconnectBtn.addEventListener("click", () => {
    localStorage.clear(); // Wipe all local storage
    window.location.href = "/"; // Redirect to home
  });
}


    // Toggle button for log visibility (optional)
    const toggleBtn = document.getElementById('toggle-log');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        messageLog.classList.toggle('closed');
      });
    }
  };
</script>

  </body>
</html>
