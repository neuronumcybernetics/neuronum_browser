<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neuronum: The Real-Time E2E Browser</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="/static/favicon.png" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>

  <body class="page-container">

    <header class="header-container">
      <div class="header-name">
        NEURONUM CYBERNETICS UG <span>&copy;</span> 2025
      </div>
    </header>

    <div class="github-icon">
      <a href="https://www.github.com/neuronumcybernetics" target="_blank">
        <i class="fa-brands fa-github"></i>
      </a>
    </div>

    <main class="hero-card">
      <img src="/static/logo.png" alt="Neuronum Logo" class="hero-logo">
      <div class="hero-title">
        <em><b>NEURONUM BROWSER v1.0.0</b></em><br>
        <b>THE REAL-TIME E2E BROWSER</b>
      </div>
      <div class="link-container">
        <a href="/connect_cell" class="link">
          CONNECT CELL <i class="fas fa-long-arrow-alt-right"></i>
        </a>
        <a href="/create_cell" class="link">
          CREATE CELL <i class="fas fa-long-arrow-alt-right"></i>
        </a>
        <a href="#" class="link" id="connect-as-guest">
          CONNECT AS GUEST <i class="fas fa-long-arrow-alt-right"></i>
        </a>
      </div>
    </main>

    <footer class="footer-container">
      <div class="fixed-footer">
        <a href="/">
          <img src="/static/logo.png" alt="Neuronum Logo - A Cyber Neuron" class="footer-logo">
        </a>
        <a class="footer-mail" href="mailto:welcome@neuronum.net">welcome@neuronum.net</a>
      </div>
    </footer>

    <div id="termspopup" class="terms-popup">
      <div class="terms-popup-meta">
        By using our services, you agree to our
        <a href="https://neuronum.net/legals" target="_blank">Terms & Conditions</a>
        and the collection and use of data as described in our
        <a href="https://neuronum.net/legals" target="_blank">Privacy Policy</a>
      </div>
      <button class="terms-close" id="termsclose">
        <span>close window<i class="fas fa-long-arrow-alt-right"></i></span>
      </button>
    </div>

  <script>
    window.onload = function() {
      const popup = document.getElementById('termspopup');
      const closeBtn = document.getElementById('termsclose');
      const currentDate = new Date().getTime();
      const agreedTimestamp = localStorage.getItem('agreedTimestamp');
      const EXPIRATION_PERIOD = 30 * 24 * 60 * 60 * 1000;

      if (!agreedTimestamp || currentDate - agreedTimestamp > EXPIRATION_PERIOD) {
        popup.style.display = 'flex';
        setTimeout(() => {
          popup.classList.add('show');
        }, 10);
      }

      closeBtn.onclick = function() {
        localStorage.setItem('agreedTimestamp', currentDate);
        popup.classList.remove('show');
        setTimeout(() => {
          popup.style.display = 'none';
        }, 500);
      };
    };

    const connectGuestButton = document.getElementById("connect-as-guest");
    if (connectGuestButton) {
      connectGuestButton.addEventListener("click", async (e) => {
        e.preventDefault();
        try {
          const response = await fetch('https://neuronum.net/api/connect_guest', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            const result = await response.json();
            console.log('Verification successful:', result);
            if (result.session) {
              localStorage.setItem('session', result.session);
            }
            if (result.host) {
              localStorage.setItem('host', result.host);
              localStorage.setItem('guest', "True");

               const keyPair = await window.crypto.subtle.generateKey(
                {
                  name: "ECDH",
                  namedCurve: "P-256",
                },
                true,
                ["deriveKey", "deriveBits"]
              );

              const privateKeyJwk = await window.crypto.subtle.exportKey("jwk", keyPair.privateKey);
              const publicKeyJwk = await window.crypto.subtle.exportKey("jwk", keyPair.publicKey);

              localStorage.setItem('privateKey', JSON.stringify(privateKeyJwk));
              localStorage.setItem('publicKey', JSON.stringify(publicKeyJwk));

            window.location.href = '/neuronum_cellai';
            }
          } else {
            const error = await response.json();
            console.error('Verification failed:', error);
            alert(error.message || "Connection failed");
          }
        } catch (err) {
          console.error("Error submitting form:", err);
          alert("An error occurred while verifying the cell key.");
        }
      });
    }
  </script>

</body>
</html>